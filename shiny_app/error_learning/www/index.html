<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scrollable Shiny App</title>
  
  <!-- Add these links in the head section of your HTML file -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;700&display=swap">
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css"/>
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick-theme.css"/>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>


  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Open Sans', sans-serif;
    }

    #navbar {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background-color: #FFFFFF;
      color: #333333; /* Charcoal grey color */
      padding: 20px;
      z-index: 1000;
      display: flex;
      align-items: center;
    }

    #navbar-title {
      margin-left: 10px;
    }

    #navbar-links {
      margin-left: auto;
      display: flex;
    }

    .nav-link {
      margin-right: 10px;
      color: #333333; /* Charcoal grey color */
      position: relative;
    }

    .nav-link::after {
      content: '';
      display: block;
      position: absolute;
      bottom: -2px; /* Adjust the distance from the text */
      left: 0;
      width: 0;
      height: 2px;
      background-color: #3498db; /* Choose the color for the underline */
      transition: width 0.3s; /* Add a smooth transition effect */
    }

    .nav-link:hover::after,
    .nav-link.active::after {
      width: 100%;
    }

    #content {
      padding-top: 60px; /* Adjusted based on navbar height */
    }

    .section {
      height: 1000px;
      padding: 20px;
    }

    #title {
      text-align: center;
      background-image: url('title_bg.jpg'); /* Replace 'title_bg.jpg' with your actual image file */
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      color: #333333; /* Charcoal grey color */
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh; /* Adjusted to cover the full height of the viewport */
    }

    h1, h2 {
      margin-bottom: 20px;
      color: #333333; /* Charcoal grey color */
    }

    .title-section {
      text-align: center;
    }
    
    .section h2 {
      text-align: center; /* Center the section headings */
    }
    
    .section2-content {
      display: flex;
      flex-direction: row;
      justify-content: space-between;
      align-items: center;
    }

    .section2-text {
      width: 45%; /* Adjust the width as needed */
    }

    .section2-image {
      width: 50%; /* Adjust the width as needed */
    }

    .section2-image img {
      width: 100%;
      height: auto;
    }
    
    .definition-container {
      text-align: left;
    }

    .definition-container.grid-layout {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 10px;
    }

    .big-word {
      font-size: 2em;
      font-weight: bold;
      margin-bottom: 10px;
      display: flex;
      align-items: center; /* Center the big word vertically */
      justify-content: center; /* Center the big word horizontally */
      height: 100%; /* Ensure the container takes full height for vertical centering */
    }

    .definition {
      font-size: 1em;
    }
    
    /* Add these styles in the head section of your HTML file */
    .carousel-container {
      width: 80%;
      margin: 0 auto;
    }
  
    .carousel {
      width: 100%;
      margin: 0 auto;
    }
  
    .slide {
      text-align: center;
    }
  
    .slide img {
      width: 100%;
      max-height: 300px; /* Adjust the maximum height as needed */
      object-fit: cover;
    }
  
    .shiny-column {
      border: 1px solid #ccc;
      height: 200px;
    }

    .large-table {
      margin-top: 20px;
    }

    .small-plotly {
      margin-top: 20px;
      border: 1px solid #ccc;
      height: 200px;
    }
    
    .slide-in {
      opacity: 0; /* Initial opacity to hide the element */
      transform: translateY(20px); /* Initial transform to move the element down */
      transition: opacity 0.5s ease-out, transform 0.5s ease-out;
      border-width: 0 !important;
    }
    
    .slide-in.active {
      opacity: 1;
      transform: translateY(0);
      border-width: 0 !important;
      box-shadow: none !important;
    }

    .slide-in iframe {
      border: none;
    }

  </style>
</head>
<body>

  <div id="navbar">
    <span id="navbar-title">Your App Title</span>
    <div id="navbar-links">
      <span class="nav-link" data-target="section1" onclick="scrollToSection('section1')">Errors</span>
      <span class="nav-link" data-target="section2" onclick="scrollToSection('section2')">Modeling</span>
      <span class="nav-link" data-target="section3" onclick="scrollToSection('section3')">Try It Yourself</span>
    </div>
  </div>

  <div id="content">
    <div id="title" class="title-section section">
      <h1>Errors</h1>
      <p>How Do YOU Learn From Them</p>
      <!-- Additional content for the title section -->
    </div>
    
    <!-- Interactive Figures Section -->
    <div id="section1" class="section">
      <h2>Interactive Figures</h2>
          <div class="container-fluid">
        <!-- First Row: Three Columns -->
        <div class="row mb-4">
          <div class="col-md-4 slide-in" id="visual1">
            <iframe src="summary.html" width="100%" height="400px"></iframe>
          </div>
          <div class="col-md-4 slide-in" id="visual2">
            <iframe src="accuracy.html" width="100%" height="400px"></iframe>
          </div>
          <div class="col-md-4 slide-in" id="visual3">
            <iframe src="learner.html" width="100%" height="400px"></iframe>
          </div>
        </div>
    
        <!-- Second Row: One Large Column and a Column to the Right -->
        <div class="row">
          <div class="col-md-4 slide-in" id="visualRight">
            <p><br></p>
            <p style='font-size:30px'>Most people learn from errors <strong>better</strong> than typical study methods</p> 
            <p><br></p>
            <p style='font-size:26px'>Almost always, they learn with a <span style="color: #9b59b6;">mediator</span> mechanism - the error acts as a secondary cue to the correct answer</p>
          </div>
          <div class="col-md-8 slide-in" id="largeVisual">
            <iframe src="dt.html" width="100%" height = "500px"></iframe>
          </div>
        </div>
      </div>
    </div>

    <div id="section2" class="section">
      <h2>Modeling</h2>
      <!-- Your HTML content for Section 2 -->
      <p>We don't just care about how <strong>people</strong> learn from errors, we specifically care about how <strong>you</strong> learn from them.
      While cognitive psychologists often look at group statistics, we take a modeling approach that is individually driven because we recognize
      that every brain is different.</p>
      <p>If you're curious about the specifics in how we model individual cognition, keep reading this section. If you want to move forward and 
      try the task yourself to see where you land as an error learner, click the button below.</p>
    </div>

    <div id="section3" class="section">
      <h2>Try It Yourself!</h2>
      <!-- Your HTML content for Section 3 -->
      <p style='font-size:20px'>Task Instructions</p>
      <p>In this task, you will learn and be tested on 60 sets of word pairs.</p>
      <p>You will begin with a learning phase where you will learn each word pair in
      one of two different ways.</p>
      <p><br></p>
      <p>In half of trials, you will see a cue word presented (i.e., "WHALE") with a text box below. In the text box,
      type-in the first word that comes to mind (i.e., "TAIL") and <strong>press the return or enter button</strong>.
      You will have 5 seconds to type in your response. It goes pretty fast!</p>
      <p>You can use the delete key to remove what you've typed but make sure to <strong>press return/enter</strong>
      to submit your word.</p>
      <p>After typing in your answer, you will see the cue word on the screen with its corresponding target. Don't
      worry if you did not correctly guess the target word, it is almost impossible!</p>
      <p><br></p>
      <p>In the other half of trials, you will see both the cue word and target word on the screen. Please study
      these words on the screen to form an association between them.</p>
      <p><br></p>
      <p>The trials will switch randomly between studying and generating a response until you have completed all 60 pairs,
      about 10 minutes.</p>
      <p>After finishing the learning phase, a 5-minute timer will appear on the screen. Please wait for this timer to be over before you take your final test by clicking the "start test session" button. This is known as the distractor phase so do whatever you'd like for these 5-minutes!</p>
      <p>Once the 5 minutes is over, you'll see a button to start the final test. The test will consists of all 60
      word pairs. You will see the cue on the screen with a textbox below where you can enter your answer. It is important to remember
      to <strong>answer with the correct target word,</strong> not the one you first generated in response to the cue.</p>
      <p>After you respond to the cue by typing in your answer, press enter/return and you will be directed to the next cue
      word to repeat the process. This test is <strong>self-paced</strong>, so take as long as you need to respond to each
      cue. Feel free to scroll back up to these instructions during your break to refresh yourself on the test protocol.
      Thanks!</p>
    </div>

  </div>

  <!-- Add these script tags at the end of your HTML file -->
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/shinyjs@1.1.0"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

  <script>
    function scrollToSection(sectionId) {
      var section = document.getElementById(sectionId);
      window.scrollTo({ top: section.offsetTop, behavior: 'smooth' });
    }

    // Add this script at the end of your HTML file
    $(document).ready(function() {
      // Initialize slick carousel
      $('.carousel').slick({
        dots: true,
        autoplay: true,
        autoplaySpeed: 2000,
      });
  
      // Add a scroll event listener to update the active state of nav links
      window.addEventListener('scroll', function() {
        var currentSection = null;
  
        // Determine the currently visible section based on scroll position
        document.querySelectorAll('.section').forEach(function(section) {
          var rect = section.getBoundingClientRect();
          if (rect.top <= window.innerHeight / 2 && rect.bottom >= window.innerHeight / 2) {
            currentSection = section.id;
          }
        });
  
        // Remove the 'active' class from all nav links
        document.querySelectorAll('.nav-link').forEach(function(link) {
          link.classList.remove('active');
        });
  
        // Add the 'active' class to the nav link corresponding to the current section
        if (currentSection) {
          document.querySelector('.nav-link[data-target="' + currentSection + '"]').classList.add('active');
        }
      });
  
      // Initialize shinyjs to ensure that shinyjs functions are available
      shinyjs.init();
      
      // Disable test until study is completed
      shinyjs.disable("startTest");
      
      // Create an object to store responses
      var responsesObject = {};
      var answerObject = {};
    
      // Define a custom function to update the word pair
      shinyjs.updateWordPair = function(cue, target, condition) {
        // Clear previous content
        $("#cueContainer").empty();
        $("#targetContainer").empty();
    
        var startTime; // Variable to store the start time
    
        if (condition === 1) {
          $("#cueContainer").text(cue);
          startTime = new Date(); // Record the start time
    
          // Create and append a text input element
          var textBox = $("<input>").attr({
            type: "text",
            id: "textBoxInput",
            placeholder: "Type your response..."
          });
          
          $("#targetContainer").append(textBox);
          // Automatically focus the textbox
          textBox.focus();
    
          $("#textBoxInput").keypress(function(event) {
            // Check if the pressed key is Enter (keyCode 13)
            if (event.which === 13) {
              var responseValue = $("#textBoxInput").val();
              var responseTime = new Date() - startTime; // Calculate elapsed time
              console.log(responseValue);
              
              // Add the response and response time to the object
              responsesObject[cue] = [responseValue, responseTime];
              console.log(responsesObject)
              
              // Clear the input field
              $("#textBoxInput").val("");
              
              // Show the study pair
              $("#targetContainer").empty();
              $("#targetContainer").text(target);
            }
          });
    
          // start study trial after 5 seconds
          setTimeout(function() {
            $("#targetContainer").empty();
            $("#targetContainer").text(target);
          }, 5000);
        } else if (condition === 2) {
          $("#cueContainer").text(cue);
          $("#targetContainer").text(target);
        }
      };
      
      // Define a custom function to update the word pair
      shinyjs.updateTest = function(cue, target) {
        // Clear previous content
        $("#cueTestContainer").empty();
        $("#answerTestContainer").empty();
    
        var startTime; // Variable to store the start time
    
        $("#cueTestContainer").text(cue);
        startTime = new Date(); // Record the start time
    
        // Create and append a text input element
        var textBox = $("<input>").attr({
          type: "text",
          id: "answerInput",
          placeholder: "Type your response..."
          });
        
        $("#answerTestContainer").append(textBox);
        // Automatically focus the textbox
        textBox.focus();
    
        $("#answerInput").keypress(function(event) {
          // Check if the pressed key is Enter (keyCode 13)
          if (event.which === 13) {
            var answerValue = $("#answerInput").val();
            var answerTime = new Date() - startTime; // Calculate elapsed time
            console.log(answerValue);
            
            // Add the response and response time to the object
            answerObject[cue] = [answerValue, answerTime];
            console.log(answerObject)
            
            // Clear the input field
            $("#answerInput").val("");
            // Tell shiny to run the next word
            Shiny.setInputValue("enterKey", JSON.stringify({cue: cue, response: answerValue, time: answerTime}));
          }
        });
      };
      // Listen for the "Start Study Session" button click
      $("#startStudy").click(function() {
        console.log("Start Study Session button clicked!");
    
        // Call the shinyjs function to update the word pair
        shinyjs.updateWordPair("Cue", "Target", "Condition");
    
        // Disable the button to prevent further clicks
        shinyjs.disable("startStudy");
      });
      
      // Listen for the "Start Study Session" button click
      $("#startStudy").click(function() {
        console.log("Start Study Session button clicked!");
    
        // Call the shinyjs function to update the word pair
        shinyjs.updateWordPair("Cue", "Target", "Condition");
    
        // Disable the button to prevent further clicks
        shinyjs.disable("startStudy");
      });
      
      // Listen for the "Start Study Session" button click
      $("#startTest").click(function() {
        console.log("Start Study Session button clicked!");
    
        // Disable the button to prevent further clicks
        shinyjs.disable("startTest");
      });
      // Add a function to send the responses to Shiny
      shinyjs.sendResponsesToShiny = function() {
        Shiny.setInputValue("responsesObject", responsesObject);
      };
      
      // Add a function to send the responses to Shiny
      shinyjs.sendAnswersToShiny = function() {
        Shiny.setInputValue("answerObject", answerObject);
      };
    });
    
    function startTimer(duration) {
        var timer = duration, minutes, seconds;
        var interval = setInterval(function () {
            minutes = parseInt(timer / 60, 10);
            seconds = parseInt(timer % 60, 10);
    
            minutes = minutes < 10 ? '0' + minutes : minutes;
            seconds = seconds < 10 ? '0' + seconds : seconds;
    
            $('#timer').text(minutes + ':' + seconds);
    
            if (--timer < 0) {
                clearInterval(interval);
                $('#timer').text('');
                // Optional: Trigger any action after timer ends
                shinyjs.enable("startTest");
            }
        }, 1000);
    }
    window.startTimer = startTimer; // Make it globally accessible
    // Function to handle scroll events
    function handleScroll() {
      var visuals = document.querySelectorAll('.slide-in');
    
      visuals.forEach(function (visual, index) {
        if (isInViewport(visual)) {
          // Calculate the delay based on the index
          var delay = index * 200; // You can adjust the delay as needed
    
          // Use setTimeout to add a delay before adding the 'active' class
          setTimeout(function () {
            visual.classList.add('active');
          }, delay);
        }
      });
    }
  
    // Attach the scroll event listener
    document.addEventListener('scroll', handleScroll);
    
    // Function to check if an element is in the viewport
    function isInViewport(element) {
      var rect = element.getBoundingClientRect();
      return (
        rect.top >= 0 &&
        rect.left >= 0 &&
        rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
        rect.right <= (window.innerWidth || document.documentElement.clientWidth)
      );
    }
    
    // Add JavaScript code to adjust text size dynamically for each iframe
    function adjustTextSize(iframeId) {
      var iframe = document.getElementById(iframeId);
    
      iframe.addEventListener('load', function() {
        // Find the dynamically generated ID starting with "htmlwidget-"
        var widgetContainer = iframe.contentDocument.querySelector('[id^="htmlwidget-"]');
        
        // Check if the widget container is found
        if (widgetContainer) {
          var plotWidth = widgetContainer.clientWidth;
    
          // Adjust text size based on the plot width
          var newTextSize = Math.max(10, Math.min(0.02 * plotWidth, 20));
    
          // Apply the new text size to all text elements in the plot
          var textElements = widgetContainer.contentDocument.querySelectorAll('.text');
          textElements.forEach(function(element) {
            element.style.fontSize = newTextSize + 'px';
          });
        }
      });
    }
        
    adjustTextSize('visual1');
    adjustTextSize('visual2');
    adjustTextSize('visual3');
    
    
  </script>

  <!-- Include Shiny app script -->
  <script src="shiny_app.js"></script>
  
</body>
</html>
